# Migration `20200616112158-4`

This migration has been generated by Elias Bundala at 6/16/2020, 11:21:58 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TYPE "Role" ADD VALUE 'MODERATOR';
ALTER TYPE "Role" ADD VALUE 'ORGANIZATION'

ALTER TABLE "public"."Bid" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."Chat" DROP COLUMN "title",
ADD COLUMN "subject" text  NOT NULL ;

ALTER TABLE "public"."Message" ADD COLUMN "body" text  NOT NULL ;

ALTER TABLE "public"."Order" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."TokenOrder" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."Transaction" ALTER COLUMN "state" SET DEFAULT E'PENDING';

ALTER TABLE "public"."User" ALTER COLUMN "role" SET DEFAULT E'USER';

CREATE UNIQUE INDEX "Transaction.externalTransRefId" ON "public"."Transaction"("externalTransRefId")

CREATE UNIQUE INDEX "Transaction.transRefId" ON "public"."Transaction"("transRefId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200614141551-3..20200616112158-4
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -91,9 +91,9 @@
 }
 model Chat {
   id        Int       @default(autoincrement()) @id
-  title     String
+  subject   String
   published Boolean   @default(false)
   author    User      @relation(name: "chat_author", fields: [authorId], references: [id])
   authorId  Int
   members   User[]
@@ -105,8 +105,9 @@
 model Message {
   id          Int       @default(autoincrement()) @id
   published   Boolean   @default(false)
   isReply     Boolean   @default(false)
+  body        String
   author      User      @relation(fields: [authorId], references: [id])
   authorId    Int
   replies     Message[]
   attachments File[]
@@ -142,10 +143,10 @@
 model Transaction {
   id                 Int        @default(autoincrement()) @id
   state              State      @default(PENDING)
-  externalTransRefId String
-  transRefId         String
+  externalTransRefId String     @unique
+  transRefId         String     @unique
   amount             Float
   updatedAt          DateTime   @updatedAt
   createdAt          DateTime   @default(now())
   TokenOrder         TokenOrder
@@ -153,8 +154,10 @@
 enum Role {
   USER
   ADMIN
+  MODERATOR
+  ORGANIZATION
 }
 enum State {
   PENDING
@@ -162,5 +165,5 @@
   REJECTED
   APPROVED
   COMPLETED
   ARCHIVED
-}
+}
```


